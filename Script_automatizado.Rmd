---
output:
  html_document:
    df_print: paged
  word_document: default
editor_options: null
---
  #7TotaldescriptivaClean5.Rmd
  #install.packages("rmarkdown")
  #library("rmarkdown")
  
  READING CREDSCO.CSV. NOTE: Change the path of the file for the proper one in your computer. 

Remember that subfolders must be indicated by "/" and not by "\"

Here you can write the introduction of your report and include some text that will be transferred to the word file every time you re-run this Markdown

WARNING: data must have been properly declared before (factors, dates...)
```{r}
# dd <- read.table("D:/karina/docencia/areferenciesPPT/0DadesPractiques/CREDSCO/credscoCategoriques2.csv",header=T, sep=";", dec=",")
#dd<- read.csv("D:/karina/TFGs/GrauEstadistica/MarcPinar/data.csv", sep=";")

#dataset<-"platjaDaro"
#dataset<-"futbol"

#setwd("D:/karina/projectes/ON/a2020INSESSCOVIDisocial/18DadesTallers")
#dd<- read.table("2Formulari5TPlataDarov1.csv",header=T, sep=",", dec=".", na.strings="*");
#dataset<-"planta"


dataset<-"nd_inputed"

```

Set the folder where the word file is going to be generated
ToDo: This should be a relative path 
```{r}

#setwd("./Documents/UNI/MD/MD2526/")
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
dd <- read.table("nd_imputed.csv", header=T, sep=",");

```

Check the type of the R object created for the dataset

```{r}            
class(dd)
```

without including the R instruction in the final document

```{r, echo=FALSE}            
class(dd)
```

Get dimensions of the dataset
```{r}
dim(dd)
n<-dim(dd)[1]
K<-dim(dd)[2]

n
K
```
Check the variables 

```{r}
names(dd)
data.frame(ID = seq_along(dd), Name = names(dd))
```
Decide if you need to declare some more factor or date

```{r}

descriptiva<-function(X, nom){
  if (!(is.numeric(X))){ 
    # Categoricas
    
    frecs<-table(as.factor(X), useNA="ifany")
    proportions<-frecs/n
    #ojo, decidir si calcular porcentages con o sin missing values
    pie(frecs, cex=0.6, main=paste("Pie of", nom))
    
    # 1. Guarda la configuración original de los parámetros gráficos
    old_par <- par(no.readonly = TRUE) 
    
    # 2. Establece los nuevos márgenes (ej: 10 líneas para el margen inferior)
    par(mar = c(10, 4, 4, 2)) 

    
    barplot(frecs, las=3, cex.names=0.7, main=paste("Barplot of", nom), col=listOfColors)
    
    
    par(old_par)
    
    print(paste("Number of modalities: ", length(frecs)))
    print("Frequency table")
    print(frecs)
    print("Relative frequency table (proportions)")
    print(proportions)
    print("Frequency table sorted")
    print(sort(frecs, decreasing=TRUE))
    print("Relative frequency table (proportions) sorted")
    print(sort(proportions, decreasing=TRUE))
    
   }
  else{
       # Numericas
       
       hist(X, main=paste("Histogram of", nom))
       boxplot(X, horizontal=TRUE, main=paste("Boxplot of",nom))
       print("Extended Summary Statistics")
       print(summary(X))
       print(paste("sd: ", sd(X, na.rm=TRUE)))
       print(paste("vc: ", sd(X, na.rm=TRUE)/mean(X, na.rm=TRUE)))
       print("Q-Q plot ")
      qqnorm(X, main = paste("QQ Plot of", nom)) # Crea el gráfico Q-Q
      qqline(X, col="red") # Añade la línea de referencia normal

      shapiro<- shapiro.test(X)
      print(shapiro)
  }
   
}

factor_with_na <- function(x, levels, labels, ordered = FALSE) {
  f <- factor(x, levels = levels, labels = labels, ordered = ordered)
  f <- addNA(f)   # convierte los NA en un nivel extra
  levels(f)[is.na(levels(f))] <- "NA"
  return(f)
}

#dataset<-dd
actives<-c(1:K)
#colDate<-1
#if (dataset=="platjaDaro")
#  {dd[,colDate]<-as.Date(dd[, colDate], format="%d/%m/%y %h:%m:%s")
#   actives<-c(3:44)
#   }

```


Basic descriptive analysis for numerical variables

(decide the maximum number of colors you can need in a graph based on your metadata file)
```{r, echo=FALSE}
listOfColors<-rainbow(39)


# esto es para cambiar el tipo de las categoricas
    
    dd$SEX <- factor_with_na(dd$SEX, 
              levels= c(0,1), 
              labels = c("Female", "Male"))
    dd$INF_ANAM <- factor_with_na(dd$INF_ANAM, 
              levels= c(0,1,2,3), 
              labels = c("zero", "one", "two", ">=three"))
    dd$STENOK_AN <- factor_with_na(dd$STENOK_AN, 
              levels= c(0,1,2,3,4,5,6), 
              labels = c("never", "last year", "one year ago", 
                         "two years ago", "three years ago", "4-5 years ago", ">=5 years ago"))
    dd$LET_IS <- factor_with_na(dd$LET_IS,                      
              levels= c(0,1,2,3,4,5,6,7), 
              labels = c("unknown (alive)" ,"cardiogenic shock","pulmonary edema",
                         "myocardial rupture","progress of congestive HF",
                         "thromboembolism", "asystole", "ventricular fibrillation"))
    dd$GB <- factor_with_na(dd$GB,                      
              levels= c(0,1,2,3), 
              labels = c("there is no EH","Stage 1","Stage 2","Stage 3"))
    dd$SIM_GIPERT <- factor_with_na(dd$SIM_GIPERT,                      
              levels= c(0,1), 
              labels = c("no", "yes"))
    dd$ZSN_A <- factor_with_na(dd$ZSN_A,
              ordered = TRUE,                           # EN R NO SE PUEDE HACER ORDEN PARCIAL! ASÍ QUE LO DEJAMOS ASÍ
              levels= c(0,1,2,3,4), 
              labels = c("there is no CHF",
                         "I stage",
                         "IIÐ stage (HF due to R VSD)",
                         "IIÐ stage (HF due to L VSD)",
                         "IIB stage (HF due to L and R VSD)"))
    dd$endocr_01 <- factor_with_na(dd$endocr_01,                      
              levels= c(0,1), 
              labels = c("no", "yes"))


par(ask=TRUE)
for(k in actives){
# If per fer la descriptiva de les variables que ens interessen (estan identificades per una id númerica. corre data.frame... que està més amunt per veure la correspondència)
  
  # QUITO EL IF PARA PROBAR, CREO QUE NO HACE FALTA PORQUE EL DATASET FILTRADO SOLO TIENE COLUMNAS QUE NOS INTERESAN
  # if(k == 2 || k == 37 ||k == 38 ||k == 84 ||k == 86 ||k == 90  || k == 89 || k == 3|| k == "SMOKE" || k == "DIABETES" ||k == "HYPERTENSION" ||k == "INF_ANAM" ||k == "STENOK_ANAM" ||k == "CHD_ANAM" ||k == "MORTALITY" ||k == "COM_SUM"){
    
    if (k != 1) { # para omitir el ID
    
    
    
    print(paste("variable ", k, ":", names(dd)[k] ))
    
    
    
    descriptiva(dd[,k], names(dd)[k])
    
    
  }
}
par(ask=FALSE)

#per exportar figures d'R per programa
#dev.off()
#png(file=mypath,width = 950, height = 800, units = "px")
#dev.off()

```
